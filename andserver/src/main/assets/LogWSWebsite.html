<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <title>WebSocket</title>
  </head>
  <body>
    <span style="color:#1f2633">启动中...</span>
  </body>
  <script>
    let address = '{ADDRESS}'
    window.addEventListener('load', (event) => {
      print("准备连接:" + address)
      connect(address)
    })

    function connect(ws) {
      let socket = new WebSocket(ws)
      socket.addEventListener('open', (event) => {
        print('连接成功!')
      })
      socket.addEventListener('error', (event) => {
        print('准备重连...')
        console.log('WebSocket error: ', event)
        setTimeout(() => {
          connect(ws)
        }, 2_000)
      })
      socket.addEventListener('message', (event) => {
        print(event.data)
      })
    }

    let tagReg = /(\[.*\])/

    function print(log) {

      let match = log.match(tagReg)
      let tag = undefined

      if (match) {
        tag = match[0]
      }

      if (tag) {
        document.write(`<span style="color:#9ea6b8">${tag}</span>`)
        log = log.replace(tag, '')
      }
      document.write(`<span style="color:#1f2633">${log}</span>`)

      document.write('<br>')
      document.write('<br>')
      let body = document.querySelector('body')
      body.scrollTop = body.scrollHeight
    }

  </script>
</html>
